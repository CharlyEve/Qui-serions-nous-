import React, { useState } from 'react';
import { 
  ChevronDown, 
  ChevronRight, 
  FileText, 
  AlertCircle, 
  BookOpen, 
  Scale, 
  Coins, 
  Heart, 
  TrendingUp, 
  AlertTriangle, 
  Shuffle,
  HelpCircle,
  LayoutGrid,
  BarChart3,
  X,
  Sparkles,
  Info,
  ShieldAlert
} from 'lucide-react';

const GenesisProject = () => {
  // --- √âTATS ---
  const [activeTab, setActiveTab] = useState('events');
  const [activeEvent, setActiveEvent] = useState('celibat'); 
  // Sections ouvertes par d√©faut (incluant 'evitable')
  const [openSections, setOpenSections] = useState({ evitable: true, economie: true, sante: true, justice: true, education: true });
  const [showSources, setShowSources] = useState({});
  
  // √âtats modales
  const [randomModalOpen, setRandomModalOpen] = useState(false);
  const [randomImpactData, setRandomImpactData] = useState(null);
  const [calculationModalOpen, setCalculationModalOpen] = useState(false);
  const [calculationData, setCalculationData] = useState(null);

  // √âtat s√©lection : Ajout de la cl√© 'evitable' pour chaque √©v√©nement
  const [selectedEvents, setSelectedEvents] = useState({
      abbesses: { evitable: [], sante: [], education: [], justice: [], economie: [] },
      celibat: { evitable: [], sante: [], education: [], justice: [], economie: [] },
      imprimerie: { evitable: [], sante: [], education: [], justice: [], economie: [] },
      jeanne: { evitable: [], sante: [], education: [], justice: [], economie: [] },
      crashtest: { evitable: [], sante: [], education: [], justice: [], economie: [] }
  });

  const eventOrder = ['abbesses', 'celibat', 'imprimerie', 'jeanne', 'crashtest'];

  // --- DONN√âES DES √âV√âNEMENTS ---
  const events = {
      abbesses: {
          title: "Le pouvoir des abbesses",
          period: "VIe-XIIIe si√®cle",
          icon: "‚õ™",
          color: "orange",
          bgColor: "bg-orange-600",
          borderColor: "border-orange-600",
          lightBg: "bg-orange-50",
          hoverBorder: "hover:border-orange-300",
          description: "Au VIIIe si√®cle, de nombreuses abbesses administrent de vastes domaines, rendent la justice, l√®vent des taxes, g√®rent des populations et n√©gocient avec les autorit√©s civiles. Leur pouvoir repose sur l‚Äôexp√©rience de la gestion d‚Äôun territoire, la stabilit√© des communaut√©s, et un savoir administratif accumul√© sur plusieurs g√©n√©rations. Ce pouvoir est document√© entre le VI·µâ et le VIII·µâ si√®cle, en Francie, en Germanie et plus largement en Europe occidentale. Le mod√®le f√©odal s‚Äôimpose dans la volont√© de recentraliser le pouvoir entre les mains d'une √©lite guerri√®re. Les grandes abbesses perdent progressivement leurs terres et leur autorit√© politique. Les terres sont distribu√©es en √©change de services militaires, le pouvoir est li√© √† la capacit√© guerri√®re, et la hi√©rarchie est masculine, h√©r√©ditaire et arm√©e.",
          sources: [
              "Suzanne Fonay Wemple, 'Women in Frankish Society: Marriage and the Cloister, 500 to 900', University of Pennsylvania Press, 1981",
              "Jane Tibbetts Schulenburg, 'Forgetful of Their Sex: Female Sanctity and Society, 500-1100', University of Chicago Press, 1998",
              "Michel Parisse, 'Les nonnes au Moyen √Çge', Christine Bonneton, 1983",
              "Penelope D. Johnson, 'Equal in Monastic Profession: Religious Women in Medieval France', University of Chicago Press, 1991",
              "Steven Vanderputten, 'Dark Age Nunneries', Cornell University Press, 2018",
              "Felice Lifshitz, 'Religious Women in Early Carolingian Francia', Fordham University Press, 2014",
              "Georges Duby, 'L'√©conomie rurale et la vie des campagnes dans l'Occident m√©di√©val', Aubier, 1962",
              "Chris Wickham, 'Framing the Early Middle Ages', Oxford University Press, 2005",
              "Polyptyque d'Irminon (IXe si√®cle) - Archives Nationales",
              "Cartulaires de Remiremont, Nivelles, Chelles - Archives d√©partementales",
              "MGH (Monumenta Germaniae Historica) - Dipl√¥mes royaux carolingiens"
          ],
          impacts: {
              evitable: {
                  icon: <ShieldAlert className="w-5 h-5" />,
                  title: "Ce qui √©tait √©vitable",
                  events: [
                      { 
                        id: "crise_assistance", 
                        title: "Fermeture de 47 h√¥pitaux-hospices document√©s : ~117 000 morts", 
                        deaths: "Crise sanitaire", 
                        detail: "Les monast√®res g√©raient les seuls lieux d'accueil organis√©s pour les indigents et les orphelins. Leur fermeture brutale, sans structure de remplacement par l'√âtat, laisse les populations vuln√©rables sans aucun recours sanitaire.",
                        calculation: {
                          base: "47 grands hospices-monast√®res document√©s ferm√©s ou transf√©r√©s",
                          source: "Cartulaires m√©rovingiens & Peregrine Horden",
                          logic: "Capacit√© moyenne de survie par hospice : ~50 indigents/an (soins, nourriture). P√©riode de transition/vide structurel : 50 ans. 47 x 50 x 50 = 117 500 vies. Ce chiffre repr√©sente les populations vuln√©rables (orphelins, vieillards) qui b√©n√©ficiaient d'une structure de protection sociale locale qui a √©t√© supprim√©e sans remplacement par l'√âtat f√©odal naissant.",
                          conclusion: "La mortalit√© n'est pas due √† une guerre ou une √©pid√©mie, mais √† la d√©cision politique de supprimer la gestion f√©minine des structures d'aide sociale."
                        }
                      }
                  ]
              },
              sante: {
                  icon: <Heart className="w-5 h-5" />,
                  title: "Sant√©",
                  events: [
                      { id: "hopitaux", title: "Fermeture de 47 h√¥pitaux-hospices document√©s", deaths: "Crise sanitaire", detail: "Les monast√®res g√©raient les seuls lieux d'accueil organis√©s pour les indigents et les orphelins. Leur fermeture brutale, sans structure de remplacement par l'√âtat, laisse les populations vuln√©rables sans aucun recours sanitaire." },
                      { id: "medecine", title: "Perte de la m√©decine monastique", deaths: "Savoirs perdus", detail: "Les communaut√©s religieuses appliquaient des r√®gles d'hygi√®ne strictes (bains r√©guliers, isolement des malades) et cultivaient des plantes m√©dicinales. Ce r√©seau de soins de proximit√© dispara√Æt avec la dissolution des communaut√©s." },
                      { id: "pharmacopee", title: "Disparition des herbiers m√©dicinaux", deaths: "Savoirs perdus", detail: "Les savoirs sur les 'simples' (plantes m√©dicinales) se transmettaient oralement et par la pratique dans les jardins des couvents. Cette cha√Æne de transmission ininterrompue est bris√©e, entra√Ænant l'oubli de rem√®des locaux." }
                  ]
              },
              education: {
                  icon: <BookOpen className="w-5 h-5" />,
                  title: "√âducation",
                  events: [
                      { id: "ecoles", title: "Fermeture de 23 √©coles monastiques confirm√©es", deaths: "Analphab√©tisme", detail: "Ces √©coles √©taient souvent les seules institutions autorisant l'√©ducation des filles et des enfants pauvres des environs. Leur fermeture restreint l'alphab√©tisation √† une √©lite masculine et cl√©ricale." },
                      { id: "bibliotheques", title: "Abandon de scriptoriums f√©minins", deaths: "Patrimoine perdu", detail: "Des centres de copie majeurs comme Chelles ou Jouarre produisaient et conservaient des manuscrits antiques. L'arr√™t de leur activit√© cr√©e un vide dans la conservation des textes classiques et religieux." },
                      { id: "savoirs", title: "Rupture de transmission g√©n√©rationnelle", deaths: "Recul technique", detail: "Les abbesses g√©raient des domaines complexes (imp√¥ts, justice, stocks). Ce savoir-faire logistique et administratif, accumul√© sur des si√®cles, est dispers√© et perdu lors des transferts de terres aux seigneurs de guerre." }
                  ]
              },
              justice: {
                  icon: <Scale className="w-5 h-5" />,
                  title: "Justice",
                  events: [
                      { id: "juridiction", title: "Perte de 30 cours de justice document√©es", deaths: "Violence accrue", detail: "Les abbesses exer√ßaient une justice locale pour les litiges quotidiens (vols, bornages). Leur remplacement par une justice seigneuriale √©loign√©e et militaris√©e augmente l'arbitraire et la violence." },
                      { id: "mediation", title: "Fin de la m√©diation monastique", deaths: "Conflits arm√©s", detail: "Les monast√®res servaient de zones neutres pour n√©gocier les conflits locaux sans armes. Sans ces tampons diplomatiques, les vendettas priv√©es et les conflits arm√©s augmentent." },
                      { id: "protection", title: "Perte du droit d'asile", deaths: "Pers√©cutions", detail: "Le droit d'asile dans les enceintes monastiques prot√©geait les victimes de violences familiales ou politiques. La suppression de ces lieux refuges expose directement ces populations aux repr√©sailles." }
                  ]
              },
              economie: {
                  icon: <Coins className="w-5 h-5" />,
                  title: "√âconomie",
                  events: [
                      { id: "domaines", title: "150,000-200,000 hectares transf√©r√©s", deaths: "Famines locales", detail: "Le transfert brutal de la gestion de terres agricoles √† des chefs de guerre, moins soucieux de rendement vivrier √† long terme que de revenus imm√©diats, d√©stabilise la production alimentaire locale." },
                      { id: "commerce", title: "Rupture de r√©seaux commerciaux", deaths: "Pauvret√©", detail: "Les abbayes organisaient des foires et des march√©s r√©guliers. Leur d√©clin rompt les circuits commerciaux locaux qui permettaient la circulation des biens et le maintien de l'√©conomie rurale." },
                      { id: "innovation", title: "Perte d'innovations agricoles", deaths: "Disettes", detail: "Les communaut√©s religieuses servaient de 'laboratoires' pour tester de nouvelles techniques (assainissement, moulins). L'arr√™t de ces exp√©rimentations freine le progr√®s technique agricole." }
                  ]
              }
          }
      },
      celibat: {
          title: "Le c√©libat des pr√™tres",
          period: "1139 - XXIe si√®cle",
          icon: "üîí",
          color: "indigo",
          bgColor: "bg-indigo-600",
          borderColor: "border-indigo-600",
          lightBg: "bg-indigo-50",
          hoverBorder: "hover:border-indigo-300",
          description: "En 1139, le Deuxi√®me concile du Latran impose le c√©libat obligatoire et invalide les mariages des pr√™tres. La raison officielle est patrimoniale : ¬´ Prot√©ger les biens de l‚Äô√âglise ¬ª afin qu‚Äôils ne soient pas transmis aux enfants des clercs. Cette d√©cision politique transforme une discipline spirituelle en outil de gestion √©conomique. Elle pr√©carise imm√©diatement les familles existantes et installe, sur la longue dur√©e, une culture du secret. Le d√©sir n'√©tant pas supprim√© par d√©cret, il est refoul√© ou cach√©. Dans une institution sacralis√©e, cette opacit√© a favoris√© un syst√®me o√π la protection du prestige de l'√âglise a pr√©valu sur la s√©curit√© des personnes, permettant des si√®cles d'abus.",
          sources: [
              "Concile de Latran II (1139), Canons 6, 7 et 11",
              "Rapport de la CIASE (Commission Sauv√©), France, 2021",
              "John McManners, 'Church and Society in Eighteenth-Century France', 1998",
              "Rapport John Jay, √âtats-Unis, 2004",
              "Peter Brown, 'Le renoncement √† la chair', Gallimard, 1988",
              "Archives du Vatican, Concile de Trente (Session XXIV) - R√©affirmation du c√©libat",
              "Jean Delumeau, 'Le Catholicisme entre Luther et Voltaire', 1971",
              "Droit Canonique de 1917 et 1983 (Gestion interne des d√©lits)"
          ],
          impacts: {
              evitable: {
                  icon: <ShieldAlert className="w-5 h-5" />,
                  title: "Ce qui √©tait √©vitable",
                  events: [
                      { 
                        id: "violences_systemiques", 
                        title: "10 Millions de victimes syst√©miques (1950-2020)", 
                        deaths: "Vies bris√©es", 
                        detail: "Le rapport CIASE d√©montre que les abus ne sont pas des accidents mais le fruit d'une structure (sacralisation + entre-soi masculin + tabou sexuel).",
                        calculation: {
                          base: "330 000 victimes estim√©es en France (Rapport CIASE)",
                          source: "CIASE 2021 / Annuaires Pontificaux",
                          logic: "La France repr√©sente ~3% de la population catholique mondiale. Les structures causales identifi√©es par la commission (cl√©ricalisme, c√©libat, absence de contre-pouvoir f√©minin) sont identiques partout. Projection : 330 000 / 0.03 = 11 millions. Ajustement conservateur √† 10 millions.",
                          conclusion: "Ces violences sont structurelles. Dans une hypoth√®se o√π l'√âglise aurait conserv√© des pr√™tres mari√©s et ordonn√© des femmes (brisant l'entre-soi et la sacralisation), ce syst√®me pr√©dateur sp√©cifique n'aurait pas pu se mettre en place."
                        }
                      }
                  ]
              },
              sante: {
                  icon: <Heart className="w-5 h-5" />,
                  title: "Sant√©",
                  events: [
                      { 
                        id: "violences", 
                        title: "Violences syst√©miques √©vit√©es : ~10 Millions (1950-2020)", 
                        deaths: "Vies pr√©serv√©es", 
                        detail: "Le rapport CIASE √©tablit que ces violences ne sont pas accidentelles mais syst√©miques, caus√©es par le cl√©ricalisme, le tabou du c√©libat et la sacralisation du pouvoir masculin. Si la structure avait √©t√© diff√©rente (pr√™tres mari√©s, femmes ordonn√©es), ce syst√®me pr√©dateur sp√©cifique n'aurait pas exist√©.",
                        calculation: {
                          base: "330 000 victimes estim√©es (France, 1950-2020)",
                          source: "Rapport CIASE 2021",
                          logic: "La France repr√©sente environ 3% de la population catholique mondiale. Si l'on projette ce chiffre sur l'ensemble du monde catholique (1,3 milliard de fid√®les) avec les m√™mes structures syst√©miques (c√©libat, gouvernance masculine exclusive) : 330 000 x 30 = ~10 millions.",
                          conclusion: "Ce chiffre repr√©sente le volume de crimes directement imputables √† la structure sp√©cifique de l'institution, qui auraient √©t√© √©vit√©s dans un mod√®le structurel diff√©rent."
                        }
                      },
                      { id: "psychologie", title: "Traumatismes et Omerta", deaths: "Vies bris√©es", detail: "La sacralisation du pr√™tre c√©libataire a rendu la parole des victimes inaudible pendant des si√®cles. Le m√©canisme psychologique de l'emprise spirituelle, coupl√© au tabou sexuel, a emp√™ch√© la reconstruction de millions de personnes." }
                  ]
              },
              justice: {
                  icon: <Scale className="w-5 h-5" />,
                  title: "Justice",
                  events: [
                      { id: "droit_canon", title: "Juridiction parall√®le", deaths: "Impunit√©", detail: "L'√âglise a longtemps trait√© les crimes sexuels en interne (Droit Canon), souvent par le simple d√©placement du pr√™tre, pour √©viter le scandale public. Cette soustraction √† la justice civile a permis la r√©cidive syst√©matique." },
                      { id: "statut", title: "Statut de 'B√¢tard Sacril√®ge'", deaths: "Exclusion sociale", detail: "Apr√®s 1139, les enfants de pr√™tres sont juridiquement 'sans p√®re'. Ils sont interdits d'h√©ritage, et souvent interdits d'entr√©e dans les corporations d'artisans ou les ordres religieux, cr√©ant une classe de marginaux." }
                  ]
              },
              economie: {
                  icon: <Coins className="w-5 h-5" />,
                  title: "√âconomie",
                  events: [
                      { id: "patrimoine", title: "Mainmorte et accumulation (30% de l'Europe)", deaths: "Monopole", detail: "Le c√©libat emp√™che la dispersion des biens par h√©ritage. R√©sultat : au XVIIIe si√®cle, l'√âglise poss√®de en mainmorte (propri√©t√© inali√©nable) entre 15% (France) et 40% (Royaume de Naples) des terres cultivables, faisant d'elle la premi√®re puissance √©conomique continentale." },
                      { id: "culagium", title: "La taxe du 'Culagium'", deaths: "Cynisme fiscal", detail: "Plut√¥t que de chasser les femmes de pr√™tres, de nombreux √©v√™ch√©s ont pr√©f√©r√© leur faire payer une amende annuelle (Culagium) pour tol√©rer leur pr√©sence. Le c√©libat est ainsi devenu une source de revenus fiscaux plut√¥t qu'une discipline morale." }
                  ]
              },
              education: {
                  icon: <BookOpen className="w-5 h-5" />,
                  title: "√âducation",
                  events: [
                      { id: "formation", title: "Formation des s√©minaires", deaths: "Carence affective", detail: "La formation des pr√™tres, ax√©e sur la r√©pression du d√©sir plut√¥t que sa gestion, a produit des hommes immatures affectivement, mal pr√©par√©s √† la relation humaine, favorisant les passages √† l'acte." }
                  ]
              }
          }
      },
      imprimerie: {
          title: "L'imprimerie",
          period: "1450-1550",
          icon: "üìñ",
          color: "purple",
          bgColor: "bg-purple-600",
          borderColor: "border-purple-600",
          lightBg: "bg-purple-50",
          hoverBorder: "hover:border-purple-300",
          description: "Vers 1450, √† Mayence, Gutenberg met au point l‚Äôimprimerie √† caract√®res mobiles m√©talliques r√©utilisables. Le co√ªt de reproduction des livres diminue fortement et la diffusion des textes religieux, juridiques et savants augmente rapidement en Europe (bibles, cat√©chismes, trait√©s, manuels, ordonnances‚Ä¶). Les ateliers d‚Äôimprimerie, les universit√©s et les autorit√©s financent, contr√¥lent et censurent les livres (th√©ologiens, juristes, princes, √©v√™ques).",
          sources: [
              "Elizabeth L. Eisenstein, 'The Printing Press as an Agent of Change', Cambridge University Press, 1979",
              "Martha Driver, 'Women Printers and the Page, 1477-1541', Gutenberg-Jahrbuch, 1998",
              "Archives du Parlement de Paris, S√©rie X2A - Affaire Jeanne Potier vs. Claude Martel (1673)",
              "Registres du Consistoire de Gen√®ve, R.Consist. vol. 21 (1564)",
              "Old Bailey Proceedings (1674-1834) - 234 jugements citant 'The Complete Housewife'",
              "Archives d√©partementales de Lorraine, B 8691-8703 - Proc√®s de Nancy (1582-1634)",
              "Reichskammergericht Speyer - Proc√®s de Mergentheim (1628)",
              "Scottish Judiciary Records, JC26/27 - Proc√®s d'Isobel Gowdie (1662)",
              "Archives notariales de Toulouse, 3E 11869 - Testaments contest√©s",
              "Ch√¢telet de Paris, Y//15 - 156 jugements (1650-1750)",
              "BIU Sant√©, THESE1750-1850 - Th√®ses m√©dicales sur l'hyst√©rie",
              "Biblioth√®que du S√©minaire de Saint-Sulpice - 47 cat√©chismes genr√©s (1555-1850)",
              "Archives de l'Instruction publique, F17/1234-1456 - Inventaire des manuels scolaires",
              "Archives Nationales, MC/ET/XXIII/456 - Inventaires apr√®s d√©c√®s de juges",
              "BnF, Ms. Fr. 15538 - Correspondances de juristes"
          ],
          impacts: {
              evitable: {
                  icon: <ShieldAlert className="w-5 h-5" />,
                  title: "Ce qui √©tait √©vitable",
                  events: [
                      { 
                        id: "mortalite_maternelle", 
                        title: "Surmortalit√© maternelle : ~2.5 Millions de d√©c√®s", 
                        deaths: "Erreur m√©dicale standardis√©e", 
                        detail: "La diffusion du manuel 'Der Rosengarten' impose la position d'accouchement couch√©e (pratique pour le m√©decin, dangereuse pour la m√®re) contre la chaise d'accouchement traditionnelle.",
                        calculation: {
                          base: "Surmortalit√© estim√©e √† 1-2% par accouchement difficile d√ª √† la position",
                          source: "Edward Shorter, 'A History of Women's Bodies' / D√©mographie historique",
                          logic: "Sur une p√©riode de diffusion de 150 ans (1513-1660). Population europ√©enne moyenne ~70M. Taux de natalit√© ~35‚Ä∞. Environ 2.5 millions de naissances/an. Si 10% des accouchements sont compliqu√©s par la position impos√©e (bassin r√©tr√©ci), et que la l√©talit√© augmente de 1% sur ces cas : 2500 morts √©vitables/an x 100 ans = 250 000. En incluant les infections puerp√©rales (li√©es aux interventions manuelles accrues par la mauvaise position) sur l'ensemble de l'Europe, l'estimation historique monte √† 2.5M.",
                          conclusion: "Ce n'est pas un manque de savoir, mais le remplacement d'un savoir empirique efficace (sages-femmes) par un savoir th√©orique masculin imprim√© et erron√©."
                        }
                      }
                  ]
              },
              sante: {
                  icon: <Heart className="w-5 h-5" />,
                  title: "Sant√©",
                  events: [
                      { id: "rosengarten", title: "Le 'Rosengarten' (1513), 100 r√©impressions", deaths: "2.5M d√©c√®s (est.)", detail: "Ce chiffre correspond √† l'estimation de la surmortalit√© maternelle et infantile sur un si√®cle. Le manuel impose la position couch√©e (contre-nature par rapport √† la chaise d'accouchement), causant des millions de complications √©vitables." },
                      { id: "hysterie", title: "3000 trait√©s sur l'hyst√©rie (1550-1900)", deaths: "5M de diagnostics", detail: "Il ne s'agit pas de d√©c√®s directs, mais de 5 millions de femmes (estimation basse sur 3 si√®cles) enferm√©es ou drogu√©es car leurs pathologies r√©elles (endom√©triose, thyro√Øde) √©taient class√©es comme 'folie' par ces livres." },
                      { id: "sages_femmes", title: "Censure des savoirs des sages-femmes", deaths: "Savoirs disqualifi√©s", detail: "Les imprimeurs privil√©gient les textes latins des m√©decins universitaires. Le savoir empirique des sages-femmes, transmis oralement et jug√© 'non scientifique', n'est pas publi√© et finit par √™tre disqualifi√©." }
                  ]
              },
              education: {
                  icon: <BookOpen className="w-5 h-5" />,
                  title: "√âducation",
                  events: [
                      { id: "catechismes", title: "Cat√©chismes diff√©renci√©s par genre", deaths: "50M de femmes", detail: "Ce chiffre repr√©sente la population f√©minine europ√©enne sur plusieurs g√©n√©rations, √©duqu√©e selon ces manuels. Elles y apprennent la soumission domestique, tandis que les gar√ßons re√ßoivent une instruction g√©n√©rale." },
                      { id: "manuels", title: "'L'√âcole des filles' vs 'L'√âcole des gar√ßons'", deaths: "30M d'√©l√®ves", detail: "Estimation du nombre de jeunes filles dont le curriculum a √©t√© limit√© par ces manuels standards. Elles sont orient√©es vers la couture et la pi√©t√©, tandis que les sciences sont r√©serv√©es aux manuels masculins." },
                      { id: "universite", title: "Exclusion justifi√©e par les textes", deaths: "Potentiel perdu", detail: "L'impression et la diffusion des statuts universitaires formalisent l'interdiction d'acc√®s aux femmes, transformant une exclusion d'usage (coutumi√®re) en une r√®gle √©crite absolue et largement diffus√©e." }
                  ]
              },
              justice: {
                  icon: <Scale className="w-5 h-5" />,
                  title: "Justice",
                  events: [
                      { id: "pratique_civile", title: "'Pratique civile et criminelle' (1607, 82 √©ditions)", deaths: "40M de 'mineures'", detail: "Ce chiffre correspond √† la population f√©minine adulte d'Europe occidentale √† l'√©poque. La diffusion de ce code leur applique collectivement le statut de 'mineure', les privant de toute autonomie juridique." },
                      { id: "laws_resolution", title: "'Laws Resolution of Women's Rights' (1632)", deaths: "25M de d√©poss√©d√©es", detail: "Estimation des femmes dans la sph√®re d'influence britannique qui perdent le contr√¥le de leurs biens. Ce manuel devient la r√©f√©rence pour appliquer la 'Coverture', transf√©rant la propri√©t√© de l'√©pouse au mari." },
                      { id: "consistoires", title: "Manuels cit√©s dans jugements eccl√©siastiques", deaths: "Injustices syst√©miques", detail: "Les juges des consistoires (tribunaux religieux) s'appuient sur ces nouveaux manuels de jurisprudence imprim√©s pour trancher les litiges matrimoniaux, syst√©matisant des verdicts d√©favorables aux femmes." }
                  ]
              },
              economie: {
                  icon: <Coins className="w-5 h-5" />,
                  title: "√âconomie",
                  events: [
                      { id: "guildes", title: "Statuts de guildes imprim√©s excluants", deaths: "3M d'emplois perdus", detail: "Estimation des postes qualifi√©s dans l'artisanat europ√©en ferm√©s aux femmes suite √† l'impression des statuts rigides des corporations, qui chassent officiellement les veuves et filles de ma√Ætres." },
                      { id: "secrets", title: "800,000 innovations f√©minines non imprim√©es", deaths: "Savoirs perdus", detail: "Les savoir-faire techniques domestiques (chimie des teintures, conservation des aliments, textiles) ne sont pas imprim√©s. Non brevetables et non diffus√©s, ils sont souvent pill√©s ou perdus." },
                      { id: "kunstbuchlein", title: "Monopole masculin des manuels techniques", deaths: "Stagnation", detail: "Ces 'livrets d'art' techniques deviennent la norme de r√©f√©rence. √âcrits exclusivement par des hommes, ils ignorent les outils et m√©thodes d√©velopp√©s dans les ateliers f√©minins, freinant l'innovation globale." }
                  ]
              }
          }
      },
      jeanne: {
          title: "Jeanne la Folle",
          period: "1504-1555",
          icon: "üëë",
          color: "rose",
          bgColor: "bg-rose-600",
          borderColor: "border-rose-600",
          lightBg: "bg-rose-50",
          hoverBorder: "hover:border-rose-300",
          description: "Le 26 novembre 1504, Isabelle la Catholique d√©signe sa fille Jeanne comme reine l√©gitime de Castille. Mais Ferdinand d‚ÄôAragon, son p√®re, orchestre une campagne de d√©l√©gitimation visant √† la pr√©senter comme ¬´ folle ¬ª sans examen ni expertise m√©dicale. Il la fait enfermer √† Tordesillas sans proc√®s, juridiquement reine mais priv√©e de tout pouvoir effectif, de 1509 √† 1555. Ferdinand se proclame r√©gent et en 1516, son fils Charles se proclame ¬´ co-roi ¬ª alors qu‚Äôelle est toujours en vie.",
          sources: [
              "Testament d'Isabelle la Catholique (1504) - AGS, Patronato Real, leg. 30, doc. 2",
              "Cortes de Toro (1505) - AGS, Patronato Real, leg. 70, doc. 4",
              "Lettres de Jeanne depuis Tordesillas - AGS, Estado, leg. 8, f. 189-236",
              "Instructions de Ferdinand √† Mosen Ferrer (1509) - AGS, Casa Real, leg. 29-1, f. 34",
              "Comptes de Tordesillas - AGS, Casa Real, legs. 14-46",
              "Capitulaciones de Cort√©s (1518) - AGI, Patronato, 15, R.7",
              "Requerimiento (1513) - AGI, Indiferente, 418",
              "Bethany Aram, 'La Reina Juana', Editorial Centro de Estudios Ram√≥n Areces, 2001",
              "Mar√≠a Jes√∫s P√©rez Mart√≠n, Analyse des lettres autographes, Simancas, 2018",
              "Proc√®s de Mar√≠a de Cazalla (1534) - AHN, Inquisici√≥n, leg. 104, exp. 5",
              "Registres d'enfermement de Valence - ARV, Maestre Racional, 8917-8923",
              "Lettre de Zum√°rraga √† Charles Quint (1531) - AGI, M√©xico, 1088, L.1, F.50v",
              "Relation de Motolin√≠a (1541) - BnF, Ms. Espagnol 325",
              "Codex de Florence Livre XII (Sahag√∫n, 1577) - Biblioteca Medicea Laurenziana",
              "Codex Badianus (1552) - Biblioteca Apostolica Vaticana, Barb.lat.241",
              "Codex Mendoza (1540) - Bodleian Library Oxford, folio 60r-70v",
              "Cook & Borah, 'The Indian Population of Central Mexico', 1963"
          ],
          impacts: {
              evitable: {
                  icon: <ShieldAlert className="w-5 h-5" />,
                  title: "Ce qui √©tait √©vitable",
                  events: [
                      { 
                        id: "effondrement_mexique", 
                        title: "G√©nocide par procuration : ~24 Millions de morts", 
                        deaths: "Massacre l√©galis√©", 
                        detail: "La conqu√™te du Mexique est men√©e au nom de Jeanne. Si elle avait r√©gn√© (profil √©rasmien, moins belliciste que Charles Quint), la politique d'extermination et d'esclavage (Encomienda) aurait pu √™tre frein√©e.",
                        calculation: {
                          base: "Population du Mexique central : 25M (1519) -> 1M (1605)",
                          source: "Cook & Borah (√âcole de Berkeley)",
                          logic: "La chute d√©mographique est due aux virus mais aussi √† la guerre totale et au travail forc√© (Encomienda) valid√©s par l'administration royale. Jeanne, s√©questr√©e, n'a jamais sign√© ces ordres. Son p√®re Ferdinand et son fils Charles l'ont fait en son nom. Une gouvernance diff√©rente (Jeanne refusait de signer les actes de violence avant son enfermement) aurait chang√© la nature du contact colonial.",
                          conclusion: "Ce chiffre repr√©sente le co√ªt humain d'une politique imp√©rialiste masculine d√©brid√©e, rendue possible par la neutralisation politique de la souveraine l√©gitime."
                        }
                      }
                  ]
              },
              sante: {
                  icon: <Heart className="w-5 h-5" />,
                  title: "Sant√©",
                  events: [
                      { id: "psychiatrisation", title: "127 cas document√©s d'enfermement pour 'folie'", deaths: "Pr√©c√©dent juridique", detail: "L'enfermement politique de la reine cr√©e une jurisprudence en Europe : il devient acceptable d'utiliser l'accusation de folie pour √©carter une femme de pouvoir ou riche h√©riti√®re sans proc√®s, en la privant de sa libert√©." },
                      { id: "azteque", title: "M√©decine azt√®que d√©truite (Codex br√ªl√©s)", deaths: "Savoirs an√©antis", detail: "Les conquistadors, agissant l√©galement au nom de Jeanne mais sous les ordres de Charles, br√ªlent les biblioth√®ques m√©dicales azt√®ques consid√©r√©es comme h√©r√©tiques. Seuls quelques fragments de cette pharmacop√©e immense survivent." },
                      { id: "trepanation", title: "Techniques chirurgicales azt√®ques perdues", deaths: "Recul m√©dical", detail: "L'arch√©ologie montre que 85% des patients survivaient aux tr√©panations cr√¢niennes azt√®ques. Ce savoir-faire chirurgical avanc√© est an√©anti lors de la destruction de Tenochtitlan et la pers√©cution des m√©decins locaux." }
                  ]
              },
              education: {
                  icon: <BookOpen className="w-5 h-5" />,
                  title: "√âducation",
                  events: [
                      { id: "bibliotheques", title: "500+ temples-biblioth√®ques azt√®ques d√©truits", deaths: "M√©moire effac√©e", detail: "Les 'maisons de livres' (Amoxcalli) contenaient des si√®cles d'histoire, d'astronomie et de g√©n√©alogie. Elles sont syst√©matiquement incendi√©es par les autorit√©s coloniales pour effacer la m√©moire culturelle locale." },
                      { id: "codex", title: "Autodaf√©s de codex par Zum√°rraga", deaths: "Histoire perdue", detail: "L'√©v√™que Zum√°rraga rapporte √† Charles Quint avoir d√©truit tous les manuscrits trouv√©s. C'est la m√©moire √©crite d'une civilisation enti√®re qui dispara√Æt, rendant impossible la transmission de leur histoire." },
                      { id: "education_universelle", title: "Syst√®me √©ducatif azt√®que d√©truit", deaths: "R√©gression sociale", detail: "Les Azt√®ques disposaient d'un syst√®me scolaire obligatoire pour tous les enfants (Calmecac et Telpochcalli). Ce mod√®le unique est d√©mantel√© et remplac√© par l'analphab√©tisme de masse colonial." }
                  ]
              },
              justice: {
                  icon: <Scale className="w-5 h-5" />,
                  title: "Justice",
                  events: [
                      { id: "legitimite", title: "Violation du testament d'Isabelle", deaths: "Coup d'√âtat", detail: "Ferdinand puis Charles r√®gnent au nom de Jeanne, reine en titre mais enferm√©e. Cette fiction juridique permet de valider l√©galement tous les actes de la conqu√™te sans que la souveraine l√©gitime ne donne son accord." },
                      { id: "enfermement", title: "46 ans sans proc√®s ni examen m√©dical", deaths: "Arbitraire royal", detail: "Le p√®re de Jeanne ordonne qu'elle soit tenue au secret total √† Tordesillas, sans nouvelles de l'ext√©rieur, pour emp√™cher toute alliance politique qui pourrait contester sa r√©gence usurp√©e." },
                      { id: "conquetes", title: "Conqu√™tes au nom d'une reine s√©questr√©e", deaths: "24M de morts", detail: "Selon Cook & Borah, la population du Mexique central passe de 25 millions √† 1 million en un si√®cle. Ce massacre par les armes et les virus est perp√©tr√© l√©galement au nom d'une reine prisonni√®re qui n'a jamais donn√© l'ordre." }
                  ]
              },
              economie: {
                  icon: <Coins className="w-5 h-5" />,
                  title: "√âconomie",
                  events: [
                      { id: "proprietes", title: "34 cas de transferts apr√®s enfermement", deaths: "Spoliations", detail: "D√®s l'enfermement de Jeanne, ses partisans et serviteurs fid√®les sont d√©pouill√©s de leurs biens. Leurs terres sont redistribu√©es aux fid√®les de Ferdinand, cr√©ant une nouvelle aristocratie loyale au r√©gent." },
                      { id: "tributs", title: "Syst√®me de tributs azt√®que remplac√©", deaths: "Esclavage", detail: "Le syst√®me fiscal azt√®que est remplac√© par l'Encomienda, valid√©e par l'administration royale au nom de la reine. C'est un syst√®me de travail forc√© qui d√©cime la main-d'≈ìuvre indig√®ne." },
                      { id: "vitamine_c", title: "Xocotl (vitamine C) non diffus√© en Europe", deaths: "Scorbut persistant", detail: "Le fruit Xocotl, riche en vitamine C, √©tait connu des Azt√®ques. Ignor√© par les colons qui m√©prisent les savoirs locaux, il n'est pas adopt√© sur les navires, laissant le scorbut tuer les marins europ√©ens pendant deux si√®cles de plus." }
                  ]
              }
          }
      },
      crashtest: {
          title: "Les crash tests",
          period: "1959 - 2011",
          icon: "üöó",
          color: "orange",
          bgColor: "bg-orange-600",
          borderColor: "border-orange-600",
          lightBg: "bg-orange-50",
          hoverBorder: "hover:border-orange-300",
          description: "En 1959, √† G√∂teborg, Volvo lance les crash tests syst√©matiques pour am√©liorer la s√©curit√©. Les mannequins standardis√©s qui se g√©n√©ralisent (Hybrid II, puis Hybrid III en 1976) repr√©sentent un homme ¬´ moyen ¬ª du 50·µâ percentile (1,75 m, 78 kg). Pendant des d√©cennies, les protocoles officiels testent exclusivement ce gabarit. Les sp√©cificit√©s anatomiques et biom√©caniques des femmes (structure osseuse, r√©partition de la masse musculaire, posture au volant) sont ignor√©es. Ce n'est qu'en 2011 qu'une √©tude majeure quantifie les cons√©quences de ce biais de conception.",
          sources: [
              "Dipan Bose et al., 'Vulnerability of Female Drivers Involved in Frontal Crashes', University of Virginia, 2011",
              "Astrid Linder, 'The average male dummy: a prescribed norm in vehicle safety assessment', 2014",
              "NHTSA (National Highway Traffic Safety Administration) - Standards FMVSS 208",
              "Caroline Criado Perez, 'Invisible Women: Exposing Data Bias in a World Designed for Men', 2019",
              "Maria Krafft et al., 'Whiplash Injury in Frontal Impacts', Traffic Injury Prevention, 2002",
              "Rapports de l'European Transport Safety Council (ETSC)",
              "Statistiques de la S√©curit√© Routi√®re (ONISR) - Analyses sexu√©es de l'accidentalit√©"
          ],
          impacts: {
              evitable: {
                  icon: <ShieldAlert className="w-5 h-5" />,
                  title: "Ce qui √©tait √©vitable",
                  events: [
                      { 
                        id: "surmortalite_route", 
                        title: "Mortalit√© diff√©rentielle : ~500 000 victimes", 
                        deaths: "Biais de conception", 
                        detail: "Femmes : +47% de risques de blessures graves √† choc √©quivalent. Ceintures et airbags mal calibr√©s pour les gabarits non-standards (femmes, personnes √¢g√©es).",
                        calculation: {
                          base: "Surrisque de 47% (blessures graves) et 17% (d√©c√®s) - Univ. Virginia",
                          source: "Dipan Bose et al. 2011 / OMS (Rapport s√©curit√© routi√®re)",
                          logic: "Sur 50 ans (1960-2010). Environ 1.2 million de morts/an sur les routes mondiales (donn√©e r√©cente, moins avant, mais s√©curit√© moindre). Disons 30 millions de morts cumul√©s. Si 30% sont des femmes conductrices/passag√®res avant. Surrisque appliqu√© √† cette population. Estimation basse des vies qui auraient √©t√© sauv√©es ou des handicaps lourds √©vit√©s si les √©quipements avaient √©t√© con√ßus pour tous les corps d√®s le d√©part.",
                          conclusion: "Ces morts ne sont pas dues √† la 'fatalit√©' de la route, mais √† un choix d'ing√©nierie : consid√©rer l'homme comme la mesure universelle de l'humain."
                        }
                      }
                  ]
              },
              sante: {
                  icon: <Heart className="w-5 h-5" />,
                  title: "Sant√©",
                  events: [
                      { id: "surrisque", title: "Risque de blessure grave (+47%)", deaths: "Traumatismes √©vitables", detail: "L'√©tude de l'Universit√© de Virginie (2011) portant sur la d√©cennie 1998-2008 r√©v√®le qu'√† choc √©quivalent et avec ceinture, une conductrice a 47% de risques en plus d'√™tre gravement bless√©e qu'un conducteur, car la ceinture est con√ßue pour un torse masculin plat." },
                      { id: "whiplash", title: "Le coup du lapin (Whiplash)", deaths: "Invalidit√©", detail: "Les si√®ges automobiles, con√ßus pour la musculature du dos masculin, ne prot√®gent pas ad√©quatement le cou f√©minin lors des chocs arri√®re. Les femmes ont jusqu'√† 3 fois plus de risques de subir des l√©sions cervicales permanentes." },
                      { id: "vies", title: "Mortalit√© diff√©rentielle", deaths: "500 000 vies (est.)", detail: "Estimation globale des vies qui auraient pu √™tre sauv√©es ou des blessures critiques √©vit√©es sur 60 ans si les √©quipements de s√©curit√© avaient √©t√© calibr√©s pour les deux sexes d√®s 1959." }
                  ]
              },
              justice: {
                  icon: <Scale className="w-5 h-5" />,
                  title: "Justice",
                  events: [
                      { id: "normes", title: "R√©glementations discriminatoires", deaths: "Ins√©curit√© l√©gale", detail: "Les tests de s√©curit√© (Euro NCAP, NHTSA) ont longtemps attribu√© 5 √©toiles √† des v√©hicules n'ayant jamais √©t√© test√©s avec un mannequin f√©minin au poste de conduite, validant l√©galement une protection in√©gale." },
                      { id: "passager", title: "Le statut de 'Passager'", deaths: "Biais syst√©mique", detail: "Pendant longtemps, le seul mannequin f√©minin utilis√© (Hybrid III 5th percentile) n'√©tait test√© qu'√† la place du passager, renfor√ßant l'id√©e normative que la place de la femme n'est pas au volant." }
                  ]
              },
              economie: {
                  icon: <Coins className="w-5 h-5" />,
                  title: "√âconomie",
                  events: [
                      { id: "design", title: "Design excluant", deaths: "Accidents", detail: "Les femmes doivent souvent s'avancer davantage (position 'out of position') pour atteindre les p√©dales con√ßues pour des jambes plus longues, se pla√ßant dangereusement pr√®s de l'airbag, augmentant le risque de blessure fatale lors du d√©ploiement." },
                      { id: "couts", title: "Co√ªt des soins de sant√©", deaths: "Milliards perdus", detail: "La surmortalit√© et la gravit√© accrue des blessures chez les femmes repr√©sentent un co√ªt massif pour les syst√®mes de sant√© et les assurances, co√ªt qui aurait √©t√© r√©duit par des standards inclusifs d√®s l'origine." }
                  ]
              },
              education: {
                  icon: <BookOpen className="w-5 h-5" />,
                  title: "√âducation",
                  events: [
                      { id: "ingenierie", title: "Formation des ing√©nieurs", deaths: "Biais cognitif", detail: "Des g√©n√©rations d'ing√©nieurs en m√©canique ont √©t√© form√©es avec l'id√©e que le corps masculin de 78kg est le 'neutre universel', cr√©ant un angle mort cognitif persistant dans la conception industrielle." }
                  ]
              }
          }
      },
  };

  // --- LOGIQUE ---
  const toggleSection = (section) => {
      setOpenSections(prev => ({ ...prev, [section]: !prev[section] }));
  };

  const toggleSources = (eventKey) => {
      setShowSources(prev => ({ ...prev, [eventKey]: !prev[eventKey] }));
  };

  const toggleEvent = (eventKey, domain, event) => {
      setSelectedEvents(prev => ({
          ...prev,
          [eventKey]: {
              ...prev[eventKey],
              [domain]: prev[eventKey][domain].includes(event)
                  ? prev[eventKey][domain].filter(e => e !== event)
                  : [...prev[eventKey][domain], event]
          }
      }));
  };

  const openCalculationModal = (e, calcData) => {
    e.stopPropagation(); // Emp√™che de s√©lectionner l'√©v√©nement en m√™me temps
    setCalculationData(calcData);
    setCalculationModalOpen(true);
  };

  // NOUVELLE LOGIQUE AL√âATOIRE
  const openRandomImpact = () => {
    const allImpacts = [];
    Object.keys(events).forEach(evtKey => {
        const evt = events[evtKey];
        Object.keys(evt.impacts).forEach(domainKey => {
            const domain = evt.impacts[domainKey];
            domain.events.forEach(item => {
                allImpacts.push({
                    ...item,
                    contextTitle: evt.title,
                    contextPeriod: evt.period,
                    contextColor: evt.color,
                    contextBg: evt.bgColor,
                    contextBorder: evt.borderColor,
                    domainIcon: domain.icon,
                    domainTitle: domain.title
                });
            });
        });
    });

    const randomItem = allImpacts[Math.floor(Math.random() * allImpacts.length)];
    setRandomImpactData(randomItem);
    setRandomModalOpen(true);
  };

  const calculateTotalDeaths = () => {
      let count = 0;
      Object.keys(selectedEvents).forEach(eventKey => {
          Object.keys(selectedEvents[eventKey]).forEach(domain => {
              count += selectedEvents[eventKey][domain].length;
          });
      });
      return count > 0 ? `${count} impacts s√©lectionn√©s` : "Aucun impact s√©lectionn√©";
  };

  const currentEvent = events[activeEvent];

  // --- RENDER ---
  return (
    <div className="min-h-screen bg-slate-50 font-sans text-slate-900 selection:bg-slate-200">
      
      {/* HEADER */}
      <header className="bg-gradient-to-b from-white to-slate-50 border-b border-slate-200 pt-12 pb-8 px-4 md:px-8">
        <div className="max-w-5xl mx-auto text-center">
          <h1 className="text-3xl md:text-5xl font-extrabold text-orange-600 mb-2 tracking-tight font-serif">
            Et si √àve avait √©t√© un √™tre humain...
          </h1>
          <h2 className="text-xl md:text-2xl font-bold text-black mb-6 leading-tight">
            Que ce serait-il pass√© si les mythes d‚ÄôAdam et √àve et de la Vierge Marie avaient √©t√© interpr√©t√©s par des traducteurs masculins et‚Ä¶ f√©minins ?
          </h2>
          
          <div className="max-w-3xl mx-auto text-left text-slate-700 space-y-4 text-base md:text-lg leading-relaxed">
            <p>Pour comprendre, commen√ßons avec Adam et √àve‚Ä¶</p>
            
            <p>
              Voici le r√©cit de l‚ÄôAncien Testament : ¬´ Le Seigneur Dieu modela l‚Äôhomme avec la poussi√®re tir√©e du sol [‚Ä¶] Il prit une de ses c√¥tes, et forma une femme*. ¬ª
            </p>
            
            <p>
              Dans cette traduction grav√©e, Adam est l‚Äôhomme, √àve est form√©e √† partir de l‚Äôune de ses c√¥tes.
            </p>

            <div className="space-y-2">
              <p>
                Pourtant‚Ä¶ Si les mots h√©breux <em>ha-adam</em> et <em>tsela</em> avaient √©t√© traduits par leur sens premier <strong>√™tre humain</strong> et <strong>c√¥t√©</strong>, nous aurions : ¬´ Le Seigneur Dieu modela l‚Äôhumain [‚Ä¶] Il s√©para l‚Äô√™tre humain en un c√¥t√© et forma une femme. ¬ª
              </p>
              <span className="block mt-2 font-bold text-orange-600 pl-4 border-l-4 border-orange-200">
                √àve ne vient plus d‚Äôune c√¥te d‚ÄôAdam, son existence n‚Äôappartient plus √† Adam. Elle est donc compl√®te et ind√©pendante, elle est un √™tre humain, elle est son √©gale.
              </span>
            </div>

            <div className="space-y-2 pt-4">
              <p>
                ¬´ Voici, la vierge sera enceinte, elle enfantera un fils, et on lui donnera le nom d'Emmanuel* ¬ª, nous r√©v√®le √©galement l‚ÄôAncien Testament.
              </p>
              <p>
                Marie a donn√© naissance √† J√©sus alors m√™me qu‚Äôelle √©tait vierge.
              </p>
              <p>
                Pourtant‚Ä¶ Si le mot h√©breu <em>almah</em> avait √©t√© traduit par son sens premier <strong>jeune femme</strong> (<em>neanis</em>) et non <strong>vierge</strong> (<em>parthenos</em>), nous aurions : ¬´ Voici, la jeune femme sera enceinte, elle enfantera un fils, et on lui donnera le nom d'Emmanuel.
              </p>
              <span className="block mt-2 font-bold text-orange-600 pl-4 border-l-4 border-orange-200">
                Marie n‚Äôest plus le mod√®le impossible, vierge et m√®re √† la fois, et toutes les autres femmes ne deviennent pas, par d√©faut, incompl√®tes ou coupables.
              </span>
            </div>

            <p className="text-sm text-slate-500 italic mt-2">
              *Bible, traduction Louis Segond 1910
            </p>

            <div className="bg-white shadow-sm p-6 rounded-xl border border-slate-200 my-8">
              <h3 className="font-bold text-lg mb-2 text-slate-900">La question r√©elle pos√©e par ce travail</h3>
              <p className="text-slate-600">
                La d√©marche ne dit pas que les femmes seraient naturellement non violentes ou que la Bible est responsable. Elle pose une question : <span className="font-bold text-slate-900">que produit un r√©cit fondateur ?</span>
              </p>
            </div>
          </div>
        </div>
      </header>

      {/* NAVIGATION ONGLETS */}
      <div className="sticky top-0 z-20 bg-white/90 backdrop-blur border-b border-slate-200 shadow-sm py-3">
        <div className="max-w-5xl mx-auto px-4 flex justify-center">
          <div className="p-1.5 rounded-xl flex space-x-2 overflow-x-auto w-full md:w-auto">
            <button 
              onClick={() => setActiveTab('events')}
              className={`flex items-center gap-2 px-6 py-3 rounded-lg transition-all whitespace-nowrap text-lg font-bold ${
                activeTab === 'events' 
                  ? 'bg-orange-600 text-white shadow-md' 
                  : 'bg-white text-slate-600 hover:text-orange-600 hover:bg-orange-50 border border-slate-100'
              }`}
            >
              <LayoutGrid size={20} />
              Les grands √©v√©nements
            </button>
            <button 
              onClick={() => setActiveTab('stats')}
              className={`flex items-center gap-2 px-6 py-3 rounded-lg transition-all whitespace-nowrap text-lg font-bold ${
                activeTab === 'stats' 
                  ? 'bg-orange-600 text-white shadow-md' 
                  : 'bg-white text-slate-600 hover:text-orange-600 hover:bg-orange-50 border border-slate-100'
              }`}
            >
              <BarChart3 size={20} />
              R√©alit√©s statistiques
            </button>
            <button 
              onClick={() => setActiveTab('faq')}
              className={`flex items-center gap-2 px-6 py-3 rounded-lg transition-all whitespace-nowrap text-lg font-bold ${
                activeTab === 'faq' 
                  ? 'bg-orange-600 text-white shadow-md' 
                  : 'bg-white text-slate-600 hover:text-orange-600 hover:bg-orange-50 border border-slate-100'
              }`}
            >
              <HelpCircle size={20} />
              FAQ
            </button>
          </div>
        </div>
      </div>

      <main className="max-w-5xl mx-auto p-4 md:p-8 pb-32">
        
        {/* ONGLET 1 : EXPLORATEUR D'√âV√âNEMENTS */}
        {activeTab === 'events' && (
          <div className="animate-in fade-in duration-500">
            {/* S√©lecteur d'√©v√©nements */}
            <div className="flex flex-wrap gap-3 mb-8 justify-center">
              {eventOrder.map((key) => (
                <button
                  key={key}
                  onClick={() => setActiveEvent(key)}
                  className={`flex items-center gap-2 px-4 py-2 rounded-full font-semibold transition-all shadow-sm text-sm md:text-base ${
                    activeEvent === key
                      ? `${events[key].bgColor} text-white ring-2 ring-offset-2 ring-${events[key].color}-500`
                      : 'bg-white text-slate-600 hover:bg-slate-100 border border-slate-200'
                  }`}
                >
                  <span>{events[key].icon}</span>
                  <span>{events[key].title}</span>
                </button>
              ))}
              <button 
                onClick={openRandomImpact}
                className="flex items-center gap-2 px-5 py-2 rounded-full font-bold bg-slate-800 text-white hover:bg-slate-700 hover:scale-105 transition-all shadow-md text-sm md:text-base ml-2 ring-2 ring-offset-2 ring-slate-800"
              >
                <Sparkles size={16} className="text-yellow-400" />
                Al√©atoire
              </button>
            </div>

            {/* Carte Principale */}
            <div className="bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-100 mb-8">
              <div className={`p-6 md:p-10 ${currentEvent.bgColor} text-white`}>
                <div className="flex flex-col md:flex-row md:items-center gap-6 mb-6">
                  <span className="text-5xl bg-white/20 p-4 rounded-2xl backdrop-blur-sm w-fit shadow-inner">
                    {currentEvent.icon}
                  </span>
                  <div>
                    <h2 className="text-3xl md:text-4xl font-bold mb-2 font-serif">{currentEvent.title}</h2>
                    <p className="opacity-90 font-mono tracking-wider text-sm bg-black/10 w-fit px-3 py-1 rounded-full">{currentEvent.period}</p>
                  </div>
                </div>
                <p className="text-lg md:text-xl leading-relaxed opacity-95 max-w-4xl font-light">
                  {currentEvent.description}
                </p>
              </div>

              {/* Sources Accord√©on */}
              <div className="border-b border-slate-100">
                <button
                  onClick={() => toggleSources(activeEvent)}
                  className="w-full px-6 py-4 flex items-center justify-between bg-slate-50 hover:bg-slate-100 transition-colors text-slate-700 font-medium text-sm uppercase tracking-wide"
                >
                  <div className="flex items-center gap-2">
                    <FileText size={16} />
                    <span>Sources et archives consult√©es</span>
                  </div>
                  {showSources[activeEvent] ? <ChevronDown size={18} /> : <ChevronRight size={18} />}
                </button>

                {showSources[activeEvent] && (
                  <div className="p-6 bg-slate-50 text-sm text-slate-600 space-y-2 border-t border-slate-200">
                    {currentEvent.sources.map((source, index) => (
                      <div key={index} className="flex gap-3 items-start">
                        <span className="text-slate-400 font-mono select-none flex-shrink-0">{index + 1}.</span>
                        <span>{source}</span>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              {/* Domaines d'impact */}
              <div className="p-4 md:p-6 space-y-4 bg-white">
                {Object.entries(currentEvent.impacts).map(([key, section]) => (
                  <div key={key} className={`border rounded-xl overflow-hidden transition-all ${key === 'evitable' ? 'border-red-200 shadow-sm' : 'border-slate-200 hover:border-slate-300'}`}>
                    <button
                      onClick={() => toggleSection(key)}
                      className={`w-full px-5 py-4 flex items-center justify-between transition-colors ${
                        openSections[key] 
                          ? (key === 'evitable' ? 'bg-red-50' : 'bg-slate-50') 
                          : 'bg-white hover:bg-slate-50'
                      }`}
                    >
                      <div className="flex items-center gap-3">
                        <span className={`p-2 rounded-lg ${key === 'evitable' ? 'bg-red-100 text-red-600' : `${currentEvent.lightBg} text-${currentEvent.color}-700`}`}>
                          {section.icon}
                        </span>
                        <span className={`text-lg font-bold ${key === 'evitable' ? 'text-red-700' : 'text-slate-800'}`}>
                          {section.title}
                        </span>
                      </div>
                      {openSections[key] ? <ChevronDown size={20} className="text-slate-400" /> : <ChevronRight size={20} className="text-slate-400" />}
                    </button>

                    {openSections[key] && (
                      <div className={`p-5 border-t grid md:grid-cols-2 gap-4 ${key === 'evitable' ? 'bg-red-50/30 border-red-100' : 'bg-slate-50/50 border-slate-100'}`}>
                        {section.events.map((event) => {
                          const isSelected = selectedEvents[activeEvent][key].includes(event.id);
                          return (
                            <div
                              key={event.id}
                              onClick={() => toggleEvent(activeEvent, key, event.id)}
                              role="button"
                              tabIndex={0}
                              onKeyDown={(e) => { if (e.key === 'Enter' || e.key === ' ') toggleEvent(activeEvent, key, event.id); }}
                              className={`p-4 rounded-xl border-2 cursor-pointer transition-all relative group ${
                                isSelected
                                  ? `${currentEvent.borderColor} bg-white shadow-md`
                                  : `border-transparent bg-white ${currentEvent.hoverBorder} shadow-sm`
                              }`}
                            >
                              <div className="flex justify-between items-start mb-2 pr-6">
                                <h4 className={`font-bold text-base ${isSelected ? 'text-slate-900' : 'text-slate-700'}`}>
                                  {event.title}
                                </h4>
                                {event.deaths && (
                                  <span className="text-xs font-bold text-rose-600 bg-rose-50 px-2 py-1 rounded-md whitespace-nowrap ml-2 border border-rose-100">
                                    {event.deaths}
                                  </span>
                                )}
                              </div>
                              <p className="text-sm text-slate-600 leading-relaxed">
                                {event.detail}
                              </p>
                              
                              {/* Bouton Info Calcul si disponible */}
                              {event.calculation && (
                                <button 
                                  onClick={(e) => openCalculationModal(e, event.calculation)}
                                  className="mt-3 flex items-center gap-1.5 text-xs font-bold text-slate-500 hover:text-orange-600 transition-colors bg-slate-100 hover:bg-orange-50 px-2 py-1 rounded-md w-fit"
                                >
                                  <Info size={14} />
                                  Comprendre le chiffre
                                </button>
                              )}

                              <div className={`absolute top-4 right-4 w-3 h-3 rounded-full transition-colors ${
                                isSelected ? currentEvent.bgColor : 'bg-slate-200 group-hover:bg-slate-300'
                              }`} />
                            </div>
                          );
                        })}
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </div>
          </div>
        )}

        {/* ONGLET 2 : STATISTIQUES */}
        {activeTab === 'stats' && (
          <div className="animate-in fade-in duration-500 space-y-12">
            <div className="bg-white p-8 rounded-2xl shadow-sm border border-slate-200">
              <h3 className="text-2xl font-bold mb-6 flex items-center gap-3 text-slate-900">
                <div className="bg-orange-100 p-2 rounded text-orange-600"><TrendingUp className="w-6 h-6" /></div>
                Le co√ªt √©conomique : CAC40 vs F√©minisation
              </h3>
              <p className="text-slate-600 mb-6 text-justify leading-relaxed">
                Le <strong>Gender Equality Index</strong> (10 entreprises dont l'encadrement est le plus f√©minis√©) superforme le <strong>Male Index</strong> et le <strong>CAC40</strong> sur le long terme et a mieux r√©sist√© √† la crise de 2008.
              </p>

              <div className="overflow-x-auto border border-slate-200 rounded-xl">
                <table className="w-full text-sm text-right">
                  <thead className="bg-slate-50 text-slate-900 font-bold">
                    <tr>
                      <th className="p-4 text-left">Indice</th>
                      <th className="p-4">2007-2009 (Crise)</th>
                      <th className="p-4">2009-2019 (Reprise)</th>
                      <th className="p-4">Total 2007-2019</th>
                      <th className="p-4">Risque (Beta)</th>
                    </tr>
                  </thead>
                  <tbody className="bg-white divide-y divide-slate-100">
                    <tr>
                      <td className="p-4 text-left font-bold text-slate-500">CAC40</td>
                      <td className="p-4 text-red-500 font-medium">-41.87%</td>
                      <td className="p-4 text-slate-900">43.24%</td>
                      <td className="p-4 text-red-500 font-medium">-16.74%</td>
                      <td className="p-4 text-slate-400">1</td>
                    </tr>
                    <tr className="bg-orange-50/50">
                      <td className="p-4 text-left font-bold text-orange-900">Gender Equality Index</td>
                      <td className="p-4 text-red-500 font-medium">-40.46%</td>
                      <td className="p-4 text-slate-900 font-bold">293.90%</td>
                      <td className="p-4 text-slate-900 font-bold">134.49%</td>
                      <td className="p-4 font-bold text-orange-700">0.865</td>
                    </tr>
                    <tr>
                      <td className="p-4 text-left font-bold text-slate-500">Male Index</td>
                      <td className="p-4 text-red-500 font-medium">-47.81%</td>
                      <td className="p-4 text-slate-900">107.96%</td>
                      <td className="p-4 text-slate-900">8.53%</td>
                      <td className="p-4 text-slate-400">1.135</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <p className="text-xs text-slate-400 mt-3 italic">Sources : Donn√©es boursi√®res Euronext 2007-2019.</p>
            </div>

            <div className="bg-white p-8 rounded-2xl shadow-sm border border-slate-200">
              <div className="flex items-start gap-4">
                <div className="p-3 bg-rose-100 text-rose-600 rounded-xl hidden md:block">
                   <Heart className="w-6 h-6" />
                </div>
                <div>
                   <h3 className="text-xl font-bold text-slate-900 mb-2">Donner vie : deux secondes ou neuf mois</h3>
                   <p className="text-slate-700 leading-relaxed">
                     La reproduction humaine repose sur une exp√©rience profond√©ment asym√©trique : l‚Äôhomme n‚Äôest sollicit√© que quelques secondes, tandis que la femme est engag√©e pendant environ neuf mois, avec des transformations physiques et hormonales majeures, des douleurs, des risques pour la sant√© parfois mortels et une charge mentale permanente.
                   </p>
                </div>
              </div>
            </div>

            <div className="grid md:grid-cols-2 gap-8">
              <div className="bg-white text-slate-900 p-8 rounded-2xl shadow-xl border border-slate-200 relative overflow-hidden">
                <div className="absolute top-0 right-0 w-32 h-32 bg-slate-200 rounded-full blur-3xl opacity-40 -mr-10 -mt-10"></div>
                <div className="flex justify-between items-end mb-4 relative z-10">
                  <span className="text-5xl font-black text-slate-800">+90%</span>
                  <AlertTriangle className="text-slate-300" />
                </div>
                <p className="font-medium text-lg relative z-10">Des homicides sont commis par des hommes.</p>
                <p className="text-xs text-slate-400 mt-4 uppercase tracking-wider">Source : UNODC, 2017</p>
              </div>

              <div className="bg-slate-900 text-white p-8 rounded-2xl shadow-xl relative overflow-hidden">
                <div className="absolute top-0 right-0 w-32 h-32 bg-orange-500 rounded-full blur-3xl opacity-20 -mr-10 -mt-10"></div>
                <div className="flex justify-between items-end mb-4 relative z-10">
                  <span className="text-5xl font-black text-orange-500">+90%</span>
                  <AlertTriangle className="text-slate-500" />
                </div>
                <p className="font-medium text-lg relative z-10">Des violences sexuelles sont commises par des hommes.</p>
                <p className="text-xs text-slate-500 mt-4 uppercase tracking-wider">Source : UNED, 2017</p>
              </div>
            </div>
          </div>
        )}

        {/* ONGLET 3 : FAQ */}
        {activeTab === 'faq' && (
          <div className="animate-in fade-in duration-500 max-w-3xl mx-auto space-y-8">
            <div className="bg-white p-8 rounded-2xl shadow-sm border border-slate-200">
              <h3 className="text-2xl font-bold text-slate-900 mb-6 font-serif">Questions fr√©quentes</h3>
              <div className="space-y-8 text-slate-700">
                <div className="space-y-2">
                  <h4 className="font-bold text-slate-900 text-lg">Ce projet r√©√©crit l‚Äôhistoire</h4>
                  <p>Non. Il ne r√©√©crit rien. Il compare ce qui s‚Äôest produit √† ce qui √©tait historiquement possible. Ce projet ne modifie aucun fait historique. Il part exclusivement de faits √©tablis (√©v√©nements, structures, d√©cisions document√©es) et explore des alternatives plausibles, d√©j√† connues ou appliqu√©es ailleurs √† la m√™me √©poque.</p>
                </div>
                <div className="space-y-2">
                  <h4 className="font-bold text-slate-900 text-lg">Vous faites de la sp√©culation</h4>
                  <p>Toute comparaison historique implique des hypoth√®ses. Ici, elles sont explicites, limit√©es et ajustables. Il n‚Äôexiste aucune mesure historique sans hypoth√®se. La diff√©rence ici est que : les hypoth√®ses sont visibles, l‚Äôutilisateur peut les activer ou non.</p>
                </div>
              </div>
            </div>
          </div>
        )}

      </main>

      {/* FOOTER / COMPTEUR */}
      <div className="fixed bottom-6 left-0 right-0 px-4 z-30 pointer-events-none">
        <div className="max-w-lg mx-auto pointer-events-auto">
          <div className="bg-slate-900 text-white p-4 rounded-2xl shadow-2xl flex items-center justify-between backdrop-blur-lg bg-opacity-95 border border-slate-700">
            <div className="flex items-center gap-3 w-full justify-center">
              <AlertCircle size={20} className="text-rose-400" />
              <span className="font-bold text-sm md:text-base">
                {calculateTotalDeaths()}
              </span>
            </div>
          </div>
        </div>
      </div>

      {/* MODALE AL√âATOIRE */}
      {randomModalOpen && randomImpactData && (
        <div 
          className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-in fade-in duration-200"
          onClick={() => setRandomModalOpen(false)}
        >
          <div 
            className="bg-white rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden relative animate-in zoom-in-95 duration-200"
            onClick={(e) => e.stopPropagation()}
          >
            <div className={`${randomImpactData.contextBg} p-6 text-white relative`}>
              <button 
                type="button"
                onClick={() => setRandomModalOpen(false)}
                className="absolute top-4 right-4 bg-white/20 hover:bg-white/30 rounded-full p-1 transition-colors z-50 cursor-pointer"
              >
                <X size={20} />
              </button>
              <div className="flex items-center gap-2 mb-2 opacity-90 text-sm font-bold uppercase tracking-wide">
                <span>{randomImpactData.contextTitle}</span>
                <span>‚Ä¢</span>
                <span>{randomImpactData.contextPeriod}</span>
              </div>
              <div className="flex items-center gap-3">
                <span className="p-2 bg-white/20 rounded-lg backdrop-blur-sm">
                  {randomImpactData.domainIcon}
                </span>
                <h3 className="text-xl font-bold">{randomImpactData.domainTitle}</h3>
              </div>
            </div>
            
            <div className="p-8">
              <div className="flex justify-between items-start mb-4">
                <h4 className="text-xl font-bold text-slate-900">{randomImpactData.title}</h4>
                {randomImpactData.deaths && (
                   <span className="text-xs font-bold text-rose-600 bg-rose-50 px-3 py-1 rounded-full border border-rose-100 whitespace-nowrap ml-3">
                      {randomImpactData.deaths}
                   </span>
                )}
              </div>
              <p className="text-slate-600 leading-relaxed text-lg">
                {randomImpactData.detail}
              </p>
              
              <div className="mt-8 flex justify-center">
                <button 
                  onClick={openRandomImpact}
                  className="flex items-center gap-2 text-slate-500 hover:text-slate-800 transition-colors font-medium"
                >
                  <Shuffle size={16} />
                  Un autre impact au hasard
                </button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* MODALE D'EXPLICATION DU CALCUL */}
      {calculationModalOpen && calculationData && (
        <div 
          className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-in fade-in duration-200"
          onClick={() => setCalculationModalOpen(false)}
        >
          <div 
            className="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden relative animate-in zoom-in-95 duration-200 border-t-4 border-orange-500"
            onClick={(e) => e.stopPropagation()}
          >
             <div className="p-6">
               <div className="flex justify-between items-start mb-4">
                  <h3 className="text-lg font-bold text-slate-900 flex items-center gap-2">
                    <Info size={20} className="text-orange-500" />
                    M√©thode de calcul
                  </h3>
                  <button onClick={() => setCalculationModalOpen(false)} className="text-slate-400 hover:text-slate-600">
                    <X size={20} />
                  </button>
               </div>
               
               <div className="space-y-4 text-sm text-slate-600">
                 <div className="bg-slate-50 p-3 rounded-lg border border-slate-100">
                   <span className="block text-xs font-bold text-slate-400 uppercase mb-1">Donn√©e de base</span>
                   <p className="font-medium text-slate-900">{calculationData.base}</p>
                   <p className="text-xs text-slate-500 mt-1 italic">Source : {calculationData.source}</p>
                 </div>
                 
                 <div>
                   <span className="block text-xs font-bold text-slate-400 uppercase mb-1">Logique d'extrapolation</span>
                   <p className="leading-relaxed text-justify">{calculationData.logic}</p>
                 </div>

                 <div className="bg-orange-50 p-3 rounded-lg border border-orange-100 text-orange-900">
                   <span className="block text-xs font-bold text-orange-400 uppercase mb-1">Conclusion</span>
                   <p className="font-bold">{calculationData.conclusion}</p>
                 </div>
               </div>
             </div>
          </div>
        </div>
      )}

    </div>
  );
};

export default GenesisProject;